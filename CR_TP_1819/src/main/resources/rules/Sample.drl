package com.sample
import com.sample.Main;
import com.sample.Sexo;
import java.util.ArrayList;
import javax.swing.JTable;
import javax.swing.DefaultListModel;
import javax.swing.JFormattedTextField;
import javax.swing.*;
 
 
global FrameInsercaoDados J1; //variável global da janela; criada no ficheiro de implementacao da janela
global GUI J2;
global ListaItems lista;
global JTable table;
global DefaultListModel<Item> listModel;
global JFormattedTextField JTextField;
global JOptionPane JP;
 
rule "Introduzir items"
    salience 100
    when
        not Item()
        not Cliente()
    then
        lista.Add(new Item(1,10.0f,"Camisola",TipoItem.Crianca,4,10));
        lista.Add(new Item(2,7.0f,"T-Shirt",TipoItem.Crianca,4,20));
        lista.Add(new Item(3,9.0f,"Saia",TipoItem.Crianca,4,10));
        lista.Add(new Item(4,15.0f,"Calças",TipoItem.Crianca,4,20));
        lista.Add(new Item(5,6.0f,"Chapéu",TipoItem.Crianca,4,10));
        lista.Add(new Item(6,20.0f,"Casaco",TipoItem.Crianca,4,20));
        lista.Add(new Item(7,13.0f,"Camisola",TipoItem.Mulher,4,10));
        lista.Add(new Item(8,10.0f,"Blusa",TipoItem.Mulher,4,20));
        lista.Add(new Item(9,15.0f,"Saia",TipoItem.Mulher,4,10));
        lista.Add(new Item(10,20.0f,"Vestido",TipoItem.Mulher,4,20));
        lista.Add(new Item(11,20.0f,"Calças",TipoItem.Mulher,4,10));
        lista.Add(new Item(12,30.0f,"Casaco",TipoItem.Mulher,4,20));
        lista.Add(new Item(13,8.0f,"Óculos",TipoItem.Mulher,4,10));
        lista.Add(new Item(14,20.0f,"Calças",TipoItem.Homem,4,20));
        lista.Add(new Item(15,25.0f,"Camisa",TipoItem.Homem,4,10));
        lista.Add(new Item(16,15.0f,"Camisola",TipoItem.Homem,4,20));
        lista.Add(new Item(17,10.0f,"T-Shirt",TipoItem.Homem,4,10));
        lista.Add(new Item(18,10.0f,"Calções",TipoItem.Homem,4,20));
        lista.Add(new Item(19,8.0f,"Óculos",TipoItem.Homem,4,10));
        lista.Add(new Item(20,12.0f,"Chapéu",TipoItem.Homem,4,20));
        lista.Add(new Item(21,7.0f,"T-Shirt - A minha mamã é a melhor",TipoItem.Crianca,4,20));
        lista.Add(new Item(22,7.0f,"T-Shirt - O meu papá é o melhor",TipoItem.Crianca,4,20));
end
 
 
 //quando não existem dados do paciente, apresenta janela de inserção de dados do mesmo
 rule "Pede dados do cliente"
    salience 99
    when
        not Cliente()
    then
        J1.setVisible(true);
 end
 
 
  //apresenta GUI de compras; se nao houver nenhuma instancia de comprar e houver 1 cliente,
 // apresenta janela de compras
 rule "Iniciar compra"
    salience 98
    when
        Cliente($id : Id)
    then
        J1.setVisible(false);
        J2.setVisible(true);
 end
 
 
 
 rule "Adicionar Carrinho e Atualizar"
    salience 97
    when
        $i : Item(AdicionarCarinho == true)
    then
    	J2.setSum($i.getPreco());
        table.setValueAt($i.getQuantidadeEmArmazem(), J2.getLinha(), 4);
        listModel.add(0,$i);
        JTextField.setValue(J2.getSum());
 end
 
 
  rule "Remover Carrinho e Atualizar"
    salience 97
    when
        $i : Item(RemoverCarinho == true)
    then
    	J2.removeSum($i.getPreco());
    	table.setValueAt($i.getQuantidadeEmArmazem(), $i.getId()-1 , 4);
        listModel.remove(J2.getLinhaLista());
        JTextField.setValue(J2.getSum());
        retract($i);
 end
 


 
 rule "Homens com filhos"
    salience 96
    when
    	$i :  Item(AdicionarCarinho == true)
        $c : Cliente(sexo == Sexo.Masculino, possuiFilhos == true, receberRecomendacaoInicial == true)
    then
    	insert(new Recomendacao("Recomendar camisola meu papa melhor",new Item(22,7.0f,"T-Shirt - O meu papá é o melhor",TipoItem.Crianca,0,20)));
        retract($i);
 end
 
 
 rule "Mulher com filhos"
 	salience 96
    when
        $i :  Item(AdicionarCarinho == true)
        $c : Cliente(sexo == Sexo.Feminino, possuiFilhos == true, receberRecomendacaoInicial == true)
    then
        insert(new Recomendacao("Recomendar camisola minha mama melhor",new Item(21,7.0f,"T-Shirt - A minha mamã é a melhor",TipoItem.Crianca,0,20)));
        retract($i);
 end
 
  
 rule "caso n possua filhos mas casado -masculino"
    salience 96
    when
    	$i :  Item()
        Cliente(sexo == Sexo.Masculino, possuiFilhos == false, estadoCivil == EstadoCivil.Casado_a)
    then
        System.out.println("masculino sem filhos");
                //retract($i);
 end
 
 rule "caso n possua filhos mas casado -feminino"
    salience 96
    when
    	$i :  Item()
        Cliente(sexo == Sexo.Feminino, possuiFilhos == false, estadoCivil == EstadoCivil.Casado_a)
    then
        System.out.println("masculino sem filhos");
                //retract($i);
end

 
 
 rule "Recomendar meu papa o melhor"
 	salience 95
 	when
 		$r : Recomendacao()
 		$c : Cliente(sexo == Sexo.Masculino, possuiFilhos == true, receberRecomendacaoInicial == true)
 	then
 	 	String[] Options = {"Sim", "Não"};
    	int x = JP.showOptionDialog(J2,"Deseja adicionar ao carrinho uma t-shirt criança («O meu papa é o melhor!»)?", "RECOMENDAÇÃO",
    	JOptionPane.DEFAULT_OPTION,JP.QUESTION_MESSAGE,null,Options, Options[0]);
    	if(x == 0){
    		int stock = (int)table.getValueAt($r.getItem().getId()-1, 4);
	    	J2.setSum($r.getItem().getPreco());
        	table.setValueAt(stock-1, $r.getItem().getId()-1 , 4);
        	listModel.add(0,$r.getItem());
        	JTextField.setValue(J2.getSum());
    	}
        $c.setReceberRecomendacaoInicial(false);
        update($c);
    	retract($r);
 end
 
 
  rule "Recomendar compra de t-shirt de criança - mama melhor"
 	salience 95
 	when
 		$r : Recomendacao()
        $c : Cliente(sexo == Sexo.Feminino, possuiFilhos == true, receberRecomendacaoInicial == true)
 	then
 	 	String[] Options = {"Sim", "Não"};
    	int x = JP.showOptionDialog(J2,"Deseja adicionar ao carrinho uma t-shirt criança («A minha mamã é a melhor!»)?", "RECOMENDAÇÃO",
    	JOptionPane.DEFAULT_OPTION,JP.QUESTION_MESSAGE,null,Options, Options[0]);
    	if(x == 0){
    		int stock = (int)table.getValueAt($r.getItem().getId()-1, 4);
	    	J2.setSum($r.getItem().getPreco());
        	table.setValueAt(stock-1, $r.getItem().getId()-1 , 4);
        	listModel.add(0,$r.getItem());
        	JTextField.setValue(J2.getSum());
    	}
        $c.setReceberRecomendacaoInicial(false);
        update($c);
    	retract($r);
 end
 
 

